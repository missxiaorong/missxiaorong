<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Missxiaorong's home</title>

    <link rel="stylesheet" href="../stylesheets/styles.css">
    <link rel="stylesheet" href="../stylesheets/github-light.css">
    <script src="../javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <style>
        body { font: normal 100% Helvetica, Arial, sans-serif; }
        .wrapper h1{
            font-size: 1.5em;
        }
        .script{
            height:auto;
            background-color: #D29BE7;

        }
        xmp{
            margin-left: 0;
        }
        .title_s{
            font-size: 1.5em;
            color: #666666;
        }
        .code{
            margin-left: 30%;
        }
    </style>
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>
<body>
<div class="wrapper">
    <header>
        <h1 class="header">Missxiaorong's home</h1>
        <p class="header">I love to pursue, to be myself.</p>

        <ul>
            <li><a class="buttons github" href="https://github.com/missxiaorong/missxiaorong">笔记</a></li>
            <li><a class="buttons github" href="https://github.com/missxiaorong/missxiaorong">收藏</a></li>
            <li><a class="buttons github" href="https://github.com/missxiaorong/missxiaorong">随记</a></li>
        </ul>

        <p class="header">sometimes life is about risking everything for a dream no one can see but you</p>
        <p>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp--please never forgive</p>

    </header>
    <section>
        <h1>
            <a id="welcome-to-github-pages" class="anchor" aria-hidden="true"><span class="octicon octicon-link">jquery瀑布流的无限加载（二）</span></a></h1>
 <a target="_blank"  href="mobile_adaption.html">下一篇文章：瀑布流的无限加载（二）</a><br/><span>实现瀑布流的方式有多种，继上一个使用了已写好的插件，这次介绍另一种方式，用jquery实现瀑布流的无限加载，代码也比较简单。</span><br/>

            这次只需要jquery.js，下载地址：<a href="http://jquery.com/">http://jquery.com/</a><br/><br/>
            然后在你的Html代码添加(src中为你的js文件的路径）

        <p>
        <div class="script">
            <xmp class="code">
    <script src="js/jquery.min.js"></script>
            </xmp>
        </div>
        <span class="title_s">css代码：</span>
        <div style="height: auto;background-color: #C373E2;  ">
            <xmp class="code">

 .container-fluid {
     padding: 0px;

 }
.box {
     margin-bottom: 20px;
    float: left;
     width: 220px;
}
.box img {
    max-width: 100%
}


            </xmp>
        </div>

        <span class="title_s">body代码：</span>
        <div style="height: auto;background-color: #C373E2; ">
            <xmp style="margin-left: 20%;">

<div id="masonry" class="container-fluid">
    <div class="box"><img src="images/1.jpg" /></div>
    <div class="box"><img src="images/2.jpg" /></div>
    <div class="box"><img src="images/3.jpg" /></div>
    <div class="box"><img src="images/4.jpg" /></div>
    <div class="box"><img src="images/5.jpg" /></div>
    <div class="box"><img src="images/6.jpg" /></div>
    <div class="box"><img src="images/7.jpg" /></div>
    <div class="box"><img src="images/8.jpg" /></div>
    <div class="box"><img src="images/9.jpg" /></div>
    <div class="box"><img src="images/10.jpg" /></div>

</div>
            </xmp>
        </div>
        <span class="title_s">js代码：</span>
        <div style="height:auto;background-color: #C373E2; ">
            <xmp  style="margin-left: 15%">

  <script type="text/javascript">
 window.onload = function(){
 //运行瀑布流主函数
 PBL('masonry','box');
//模拟数据
 var data = [
{'src':'1.jpg'},
{'src':'2.jpg'},
{'src':'3.jpg'},
{'src':'4.jpg'},
{'src':'5.jpg'},
{'src':'6.jpg'},
{'src':'7.jpg'},
{'src':'8.jpg'},
{'src':'9.jpg'},
{'src':'10.jpg'}
 ];

//设置滚动加载
window.onscroll = function(){
//校验数据请求
    if(getCheck()){
    var masonry = document.getElementById('masonry');
    for(i in data){
//创建box
     var box = document.createElement('div');
     box.className = 'box';
     masonry.appendChild(box);
     var img = document.createElement('img');
     img.src = 'images/'+data[i].src;
     img.style.height = 'auto';
     box.appendChild(img);
     }
      PBL('masonry','box');
    }
    }
 }
                    /**
                     * 瀑布流主函数
                     * @param  masonry	[Str] 外层元素的ID
                     * @param  box 	[Str] 每一个box的类名
                     */
function PBL(masonry,box){
//	1.获得外层以及每一个box
    var masonry = document.getElementById(masonry);
    var boxs  = getClass(masonry,box);
    //	2.获得屏幕可显示的列数
    var boxW = boxs[0].offsetWidth;
    var colsNum = Math.floor(document.documentElement.clientWidth/boxW);
     masonry.style.width = boxW*colsNum+'px';//为外层赋值宽度
     //	3.循环出所有的box并按照瀑布流排列
     var everyH = [];//定义一个数组存储每一列的高度
     for (var i = 0; i < boxs.length; i++) {
         if(i<colsNum){
         everyH[i] = boxs[i].offsetHeight;
        }else{
          var minH = Math.min.apply(null,everyH);//获得最小的列的高度
          var minIndex = getIndex(minH,everyH); //获得最小列的索引
          getStyle(boxs[i],minH,boxs[minIndex].offsetLeft,i);
           everyH[minIndex] += boxs[i].offsetHeight;//更新最小列的高度
        }
       }
}
                    /**
                     * 获取类元素
                     * @param  warp		[Obj] 外层
                     * @param  className	[Str] 类名
                     */
                    function getClass(masonry,className){
                        var obj = masonry.getElementsByTagName('*');
                        var arr = [];
                        for(var i=0;i<obj.length;i++){
                            if(obj[i].className == className){
                                arr.push(obj[i]);
                            }
                        }
                        return arr;
                    }
                    /**
                     * 获取最小列的索引
                     * @param  minH	 [Num] 最小高度
                     * @param  everyH [Arr] 所有列高度的数组
                     */
function getIndex(minH,everyH){
    for(index in everyH){
        if (everyH[index] == minH ) return index;
    }
 }
                    /**
                     * 数据请求检验
                     */
function getCheck(){
    var documentH = document.documentElement.clientHeight;
    var scrollH = document.documentElement.scrollTop || document.body.scrollTop;
    return documentH+scrollH>=getLastH() ?true:false;
}
                    /**
                     * 获得最后一个box所在列的高度
                     */
function getLastH(){
    var masonry = document.getElementById('masonry');
    var boxs = getClass(masonry,'box');
    return boxs[boxs.length-1].offsetTop+boxs[boxs.length-1].offsetHeight;
}
                    /**
                     * 设置加载样式
                     * @param  box 	[obj] 设置的Box
                     * @param  top 	[Num] box的top值
                     * @param  left 	[Num] box的left值
                     * @param  index [Num] box的第几个
                     */
var getStartNum = 0;//设置请求加载的条数的位置
function getStyle(box,top,left,index){
    if (getStartNum>=index) return;
    $(box).css({
     'position':'absolute',
     'top':top,
      "left":left,
       "opacity":"0"
        });
     $(box).stop().animate({
       "opacity":"1"
        },999);
      getStartNum = index;//更新请求数据的条数位置
}
</script>
            </xmp>
        </div>

         <a target="_blank"  style="margin-left: 30%" href="mobile_adaption.html">下一篇文章：HTML5页面移动设备自适应宽度总结</a>
        </p>

        <div id="uyan_frame"></div>
    </section>
    <footer>
    </footer>
</div>

    <script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=2078700"></script>
    <!-- UY END -->
  </body>

  <script>
      $(document).ready(function(){
          var SideComments = require('side-comments');
          window.sideComments = new SideComments('#commentable-container', currentUser, existingComments);
          window.sideComments.on('commentPosted', function( comment ) {
              comment.id = parseInt(Math.random() * (100000 - 1) + 1);
              sideComments.insertComment(comment);
          });
          window.sideComments.on('commentDeleted', function( comment ) {
              sideComments.removeComment(comment.sectionId, comment.id);
          });
      });
  </script>
<!--[if !IE]><script>fixScale(document);</script><![endif]-->
</html>


</html>
